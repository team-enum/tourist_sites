<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Detail</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=dc3712f3dcab23343dcdc67128ca4c79"></script>
</head>
<body>
    <div th:object="${item}">
        <h3 th:text="*{title}">제목</h3>
        <div th:text="*{address1}">주소</div>
        <div th:utext="*{homepage}">홈페이지</div>
        <div th:text="*{tel}">전화 번호</div>
        <img th:src="*{image1}"/>
        <div th:utext="*{overview}">상세</div>
    </div>

    <div id="map" style="width:100%;height:350px;"></div>

    <div>
        <form sec:authorize="isAuthenticated()" th:action="@{/detail/{contentId}/comments(contentId=${item.contentId})}" method="post">
            <label for="comment">댓글 작성:</label><br>
            <input type="text" id="comment" name="comment" /><br><br>
            <input type="submit" value="등록" />
        </form>
    </div>
    <div>
        <h3>댓글 목록</h3>
        <div th:each="comment : ${comments}">
            <div>
                <span th:text="${comment.commentText}"></span>
                <form th:action="@{/detail/{contentId}/comments/{commentId}/edit(contentId=${item.contentId}, commentId=${comment.commentId})}" method="post">
                    <input type="hidden" id="commentId" name="commentId" th:value="${comment.commentId}" />
                    <label for="updatedComment">댓글 수정:</label><br>
                    <input type="text" id="updatedComment" name="updatedComment" th:value="${comment.commentText}" /><br><br>
                    <input type="submit" value="수정" />
                </form>
                <form th:action="@{/detail/{contentId}/comments/{commentId}/delete(contentId=${item.contentId}, commentId=${comment.commentId})}" method="post">
                    <input type="hidden" id="commentId" name="commentId" th:value="${comment.commentId}" />
                    <input type="submit" value="삭제" />
                </form>
            </div>
        </div>
    </div>
    
    <script th:inline="javascript">
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
            center: new kakao.maps.LatLng([(${item.mapy})], [(${item.mapx})]), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        // 지도를 클릭한 위치에 표출할 마커입니다
        var marker = new kakao.maps.Marker({ 
            // 지도 중심좌표에 마커를 생성합니다 
            position: map.getCenter() 
        }); 
        // 지도에 마커를 표시합니다
        marker.setMap(map);

        // 지도에 클릭 이벤트를 등록합니다
        // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            // 클릭한 위도, 경도 정보를 가져옵니다 
            var latlng = mouseEvent.latLng; 
            // 마커 위치를 클릭한 위치로 옮깁니다
            marker.setPosition(latlng);
            var resultDiv = document.getElementById('clickLatlng'); 
        });
    </script>
</body>
</html>
